var pushNotifications=function(){var i={apiKey:"AIzaSyAGqwrEVdEKwmFME_KdvALF1i9_0bH7eCo",authDomain:"bikewale-android.firebaseapp.com",databaseURL:"https://bikewale-android.firebaseio.com",projectId:"bikewale-android",storageBucket:"bikewale-android.appspot.com",messagingSenderId:"1018464172822",appId:"1:1018464172822:web:c7d20788ed7d10009c2e37"},o="BW_WebNotification",e=isMobile?"platform=Mobile":"platform=Desktop",n="fcmtokenvalue",t=window.location.origin+"/",a=!1;function r(){"undefined"!=typeof cwTracking&&cwTracking.trackCustomData(o,"PageChanged",e)}function s(i){"undefined"!=typeof cwTracking&&cwTracking.trackCustomData(o,i,e)}function c(){return new Promise((function(i,n){"undefined"!=typeof firebase&&void 0!==firebase.messaging&&firebase.messaging.isSupported()?(window.addEventListener("beforeunload",r),Notification.requestPermission().then((function(o){window.removeEventListener("beforeunload",r),"granted"===o?(s("ConfirmationPopupAllowClick"),FCM.saveFCMData(!0)):"denied"===Notification.permission?s("ConfirmationPopupDenyClick"):(s("ConfirmationPopupCloseOrNotNowClick"),bwcache.set("notificationPopupShown",!0,!0)),i(o)})),cwTracking.trackCustomData(o,"ConfirmationPopupImpression",e),a=!0):n()}))}function u(){return firebase.messaging().getToken()}function f(i){document.cookie=n+"="+i}function p(i){var n="FCMTokenRefreshed";FCM.saveFCMData(!0),i&&(n="FCMTokenDeleted"),cwTracking.trackCustomData(o,n,e)}function d(i){if(!i){var o=function(i){var o,e,n={},t={cookieExists:!1},a=document.cookie;a=a.split(";");for(var r=0;r<a.length;r++)o=a[r].split("="),n[o[0].trim()]=o[1];void 0!==(e=n[i])&&(t.cookieExists=!0,t.value=e);return t}(n);o.cookieExists?u().then((function(i){i!=o.value&&p(!1)}),(function(i){errorLog(i)})):u().then((function(i){void 0!==i&&f(i)}),(function(i){errorLog(i)}))}}function g(){var i=new Promise((function(i,o){pushNotifications.getTokenDataFromIndexDB().then((function(o){var e=!1;void 0!==o?pushNotifications.saveFCMTokenInCookie(o.fcmToken):(e=!0,pushNotifications.resubscribeUser(!0)),i(e)}),(function(i){errorLog(i)}))}));pushNotifications.initialValidation(i)}return _privateMode=!1,{init:function(){return new Promise((function(n,t){"serviceWorker"in navigator?new Promise((function(n,t){navigator.serviceWorker.getRegistration("/m/").then((function(i){i&&i.active&&i.active.scriptURL==window.location.origin+"/m/sw.js"&&i.unregister()})),navigator.serviceWorker.register("/root-sw.js").then((function(o){firebase.messaging.isSupported()&&(firebase.initializeApp(i),"denied"!==Notification.permission&&window.addEventListener("load",g),firebase.messaging().useServiceWorker(o),n())})).catch((function(i){"undefined"!=typeof cwTracking&&cwTracking.trackCustomData(o,"FCMPopupNotShown",e+"|errorlog=failed to register service worker"),t()}))})).then((function(){n()}),(function(){t()})):t()}))},cat:o,platformLab:e,saveFCMTokenInCookie:f,getTokenDataFromIndexDB:function(){return firebase.messaging().tokenDetailsModel.getTokenDetailsFromSWScope(t)},resubscribeUser:p,initialValidation:function(i){"granted"===Notification.permission&&i.then(d)},openNotificationPopup:function(){"default"!==Notification.permission||bwcache.get("notificationPopupShown",!0)?"granted"===Notification.permission&&bwcache.get("fcmTokenFailure",!1)&&FCM.saveFCMData(!0):c()},showBrowserNotification:c,isPopupShown:function(){return a},setPopupShown:function(i){a=i}}}(),optInPopupExperiments=function(){function i(){return void 0!==navigator.userAgent&&navigator.userAgent.indexOf("Chrome")>-1&&"undefined"!=typeof gaObj&&38===gaObj.id&&"undefined"!=typeof gaEditorialPageTypes&&1===gaEditorialPageTypes.id}return{handleOptInPopupExperiments:function(){pushNotifications.init().then((function(){i()?"default"===Notification.permission&&pushNotifications.showBrowserNotification().then((function(){pushNotifications.setPopupShown(!1),notificationSubscriptionButton.resetPopupContent(),document.getElementById("notificationPopup")&&document.querySelector(".popup-active")&&notificationPopup.closePopup()})):pushNotifications.openNotificationPopup()}))}}}();optInPopupExperiments.handleOptInPopupExperiments();