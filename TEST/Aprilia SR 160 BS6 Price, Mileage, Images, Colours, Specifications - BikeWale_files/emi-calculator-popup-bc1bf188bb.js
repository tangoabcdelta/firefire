var emiCaluculatorContainer,isMobile=$("#mobileEmiCalculator"),emiPopup=$("#emiPopup"),emiCalculator={setting:{effect:"slide",directionleft:{direction:"down"},duration:500},open:function(e){isMobile.length?(e.show(emiCalculator.setting.effect,emiCalculator.setting.directionleft,emiCalculator.setting.duration,(function(){})),lockPopup()):(e.fadeIn(100),popup.lock()),window.history.pushState("addEMIPopup","","")},close:function(e){isMobile.length?($("#leadCapturePopup").is(":visible")&&"undefined"!=typeof LeadPopupState&&void 0!==LeadPopupState.close&&(LeadPopupState.close(),"undefined"!=typeof windowScreen&&windowScreen.unlock()),$("#emiPopup").is(":visible")&&e.hide(emiCalculator.setting.effect,emiCalculator.setting.directionleft,emiCalculator.setting.duration,(function(){})),unlockPopup()):($("#leadCapturePopup").is(":visible")&&LeadPopupState.close(),popup.unlock(),e.fadeOut(100))}};function fetchEmiPopupDetails(e,i,a,o,t){checkCampaignAvailablity(i,e,t,a,o)}function fetchEmiPopUpPrice(e,i,a,o,t){$.ajax({async:!1,type:"GET",url:"/api/onroadpricewithnearbycitylogic/?cityId="+e+"&modelId="+i+"&versionId="+a+"&dealerId="+t,contentType:"application/json",dataType:"json",success:function(e){if(null!=e&&null!=e.VersionPrices&&void 0!==EMIviewModel&&e.VersionPrices.length>0){var i=e.VersionPrices.filter((function(e){return e.VersionId==a}));e.PriceType===PriceTypeEnum.CityPrice?i.length>0&&i[0].OnRoadPrice>0&&setPricingForEmiPopup(i[0].OnRoadPrice,!0,o,i[0].City):void 0!==EMIviewModel&&e.VersionPrices[0].OnRoadPrice>0&&setPricingForEmiPopup(i[0].OnRoadPrice,!1,o,i[0].City)}},error:function(e){setPricingForEmiPopup(bikeVersionPrice,!0,"")},complete:function(e,i,a){openEmiCalcPopup(),$("#emiPopup .emi-popup-close-btn, .blackOut-window, .leadCapture-close-btn").click((function(){setTimeout((function(){window.location.reload(!0)}),200)}))}})}function checkCampaignAvailablity(e,i,a,o,t){var n=0;$.ajax({async:!1,type:"GET",url:"/api/campaign/modelId/"+e+"/cityId/"+i+"/?areaId="+a,contentType:"application/json",dataType:"json",success:function(e){if(e&&(null!=e.dealerCampaign||null!=e.manufacturerCampaign))if(e.dealerCampaign&&e.dealerCampaign.dealerId>0&&e.dealerCampaign.campaignId>0)EMIviewModel.isCampaignAvailable(!0),leadVM.isLeadPopupFlow(!0),setEmiCalcLeadBtnForDS($("#btnEmiQuoteAfterLocation"),e.dealerCampaign),n=e.dealerCampaign.dealerId;else if(e.manufacturerCampaign&&(e.manufacturerCampaign.emiCampaign||e.manufacturerCampaign.leadCampaign)){var i=null!==e.manufacturerCampaign.leadCampaign?e.manufacturerCampaign.leadCampaign:e.manufacturerCampaign.emiCampaign;i&&i.dealerId>0&&i.campaignId>0&&(EMIviewModel.isCampaignAvailable(!0),setEmiCalcLeadBtnForES($("#btnEmiQuoteAfterLocation"),i))}else EMIviewModel.isCampaignAvailable(!1)},complete:function(a,l,d){openEmiCalcPopup(),$("#btnEmiQuoteAfterLocation").click((function(){emiPopup.is(":visible")&&emiCalculator.close(emiPopup)})),fetchEmiPopUpPrice(i,e,o,t,n)}})}function setEmiCalcLeadBtnForDS(e,i){$(e).attr({"data-leadsourceid":isMobile.length>0?38:57,"data-campaignid":i.campaignId,"data-item-name":i.organization,"data-item-area":i.area,"data-pqsourceid":isMobile.length>0?176:178,"data-item-id":i.dealerId,"data-cityname":i.city,rel:"nofollow","data-versionid":versionId,"data-isregisterpq":"true","data-clientip":null!=clientIP?clientIP:""}),initialiseLeadPopup()}function initialiseLeadPopup(){if("undefined"!=typeof leadVM){var e=GetGlobalLocationObject();leadVM.isLeadPopupFlow(!0),leadVM.cityId(e.CityId),leadVM.areaId(e.AreaId),leadVM.isLeadPopupFlow(!0),leadVM.selectedCity({cityId:e.CityId,cityName:e.CityName,areaId:e.AreaId,areaName:e.AreaName}),leadBikeName="undefined"!=typeof leadBikeName?leadBikeName:"undefined"!=typeof bikeName?bikeName:"",leadmodelid="undefined"!=typeof leadmodelid?leadmodelid:"undefined"!=typeof bikeModelId?bikeModelId:0,leadVM.selectedBike({model:{modelName:leadBikeName,modelId:leadmodelid}})}}function setEmiCalcLeadBtnForES(e,i){$(e).attr({"data-leadsourceid":isMobile.length>0?38:57,"data-item-name":i.organization,"data-item-area":"","data-pqsourceid":isMobile.length>0?176:178,"data-item-id":i.dealerId,"data-cityname":i.city,rel:"nofollow","data-versionid":versionId,"data-isregisterpq":"true","data-clientip":null!=clientIP?clientIP:"","data-item-organization":i.Organization,"data-item-heading":i.popupHeading,"data-item-message":i.popupSuccessMessage,"data-item-description":i.popupDescription,"data-ispincodrequired":i.pincodeRequired,"data-isotprequired":i.isOtpRequired,"data-isemailrequired":i.emailRequired,"data-dealersrequired":i.dealerRequired,"data-issendleadsmscustomer":i.sendLeadSMSCustomer,"data-mfgcampid":i.campaignId}),initialiseLeadPopup()}function setPricingForEmiPopup(e,i,a,o){EMIviewModel.handleVersionChange(e),EMIviewModel.showDiffCityPriceDisclaimer(!i),EMIviewModel.diffPriceCityName(o),EMIviewModel.locationCityName(a.includes("&amp;")?a.replace("&amp;","&"):a)}function openEmiCalcPopup(){emiCalculator.open(emiPopup);var e=document.querySelector(".emi-quote__btn-block > .bw-bhrigu-shown-after-click");null!=e&&trackElementVisiblity(e)}$("body").on("click","#emiCalculatorLink",(function(e){openEmiCalcPopup()})),$("body").on("keypress",(function(e){27===e.keyCode&&$("#emiPopup")&&$("#emiPopup").is(":visible")&&(emiCalculator.close(emiPopup),window.history.back())})),$("#emiPopup .emi-popup-close-btn, .blackOut-window").mouseup((function(){emiPopup.is(":visible")&&(emiCalculator.close(emiPopup),window.history.back())})),$("#leadCapturePopup .leadCapture-close-btn").mouseup((function(){isMobile.length&&$("#leadCapturePopup").is(":visible")&&"leadCapture"===window.history.state&&(window.history.back(),setTimeout((function(){(emiPopup.is(":visible")||"addEMIPopup"===window.history.state)&&window.history.back()}),1))})),$(window).on("popstate",(function(e){$("#leadCapturePopup").is(":visible")&&"leadCapture"!==window.history.state&&(emiCalculator.close($("#leadCapturePopup")),setTimeout((function(){(emiPopup.is(":visible")||"addEMIPopup"===window.history.state)&&window.history.back()}),1)),(emiPopup.is(":visible")||"addEMIPopup"===window.history.state)&&emiCalculator.close(emiPopup)})),$(document).keyup((function(e){27==e.keyCode&&emiPopup.is(":visible")&&(emiCalculator.close(emiPopup),window.history.back())}));var bikeVersionPrice=parseInt(document.getElementById("emiPopup").dataset.bikeversionprice);if("undefined"!=typeof KOEmiCalculator)var EMIviewModel=new KOEmiCalculator(bikeVersionPrice,document.getElementById("emiPopup"),null).applyBindings().bindMonthlyEmiValue(document.getElementById("emiValue"));$("#btnEmiQuote").on("click",(function(){emiPopup.fadeOut(100),isMobile&&unlockPopup()})),window.addEventListener("load",(function(){isCookieExists("emiCalcPopupFlow")&&(DeleteCookie("emiCalcPopupFlow"),openEmiCalcPopup())}));