var leadBtnBookNow,leadCapturePopup,leadBike,fullName,emailid,mobile,assistanceGetName,assistanceGetEmail,assistanceGetMobile,detailsSubmitBtn,leadVM,brandSearchBar,dealerSearchBrand,dealerSearchBrandForm,windowScreen,dropdown,gaLabel="",eventAction="Lead_Submitted",prevEmail="",prevMobile="",prevPinCode="",objPinCodes=new Object,fbPixelLeadEvent="",LeadPopupOriginEnum={Finance:1,NonFinance:2},makeId="undefined"!=typeof makeid?parseInt(makeid):void 0!==makeId?parseInt(makeId):0,isHiddenLeadSubmission=!1,isSendLeadsToLxms=!1,LeadPopupTrackingEvent={ESLeadPopUpShown:1,DSLeadPopUpShown:2,Close:3,Success:4},LeadCategoryEnum={ES:1,DS:2,Recommendation:3,MLA:4,MaskingNumber:5},LeadTypeEnum={ES:1,DS:2};function leadModel(){var a=this,t=setuserDetails(),o=GetGlobalLocationObject();null!=t&&t.length>0?(a.fullName=ko.observable(t[0]&&"undefined"!=t[0]?t[0]:""),a.emailId=ko.observable(t[1]&&"undefined"!=t[1]?t[1]:""),a.mobileNo=ko.observable(t[2]&&"undefined"!=t[2]?t[2]:"")):(a.fullName=ko.observable(),a.emailId=ko.observable(),a.mobileNo=ko.observable()),a.msg="";var d={id:0,name:"",isPopular:!1,hasAreas:!1};a.IsVerified=ko.observable(!1),a.pqGUId=ko.observable(),a.pqId=ko.observable(0),a.dealerId=ko.observable(),a.modelId="undefined"!=typeof leadmodelid?ko.observable(leadmodelid):ko.observable(0),a.versionId=ko.observable(),a.cityId="undefined"!=typeof leadcityid?ko.observable(leadcityid):ko.observable(0),a.areaId="undefined"!=typeof leadareaid?ko.observable(leadareaid):ko.observable(0),a.dealerName=ko.observable(),a.leadSourceId=ko.observable(),a.dealerArea=ko.observable(),a.pqSourceId=ko.observable(),a.pageUrl=window.location.href,a.clientIP="",a.cityFilter=ko.observable(""),a.isRegisterPQ=ko.observable(!1),a.isDealerBikes=ko.observable(!1),a.dealerBikes=ko.observableArray([]),a.selectedBike=ko.observable(),a.campaignId=ko.observable(),a.GAObject=ko.observable(),a.mfgCampaignId=ko.observable(),a.IsLeadPopup=ko.observable(!0),a.dealerHeading=ko.observable(),a.dealerMessage=ko.observable(),a.dealerDescription=ko.observable(),a.eventCategory=ko.observable(),a.cities=ko.observableArray(),a.selectedCity=ko.observable(),a.ko_DealerName=ko.observable(),a.sendLeadSMSCustomer=ko.observable(!1),a.organizationName=ko.observable(),Required=ko.observable(),a.emailRequired=ko.observable(!1),a.emailOption=ko.observable(),a.pinCodeRequired=ko.observable(!1),a.isOtpRequired=ko.observable(!1),a.dealersRequired=ko.observable(!1),a.cityRequired="undefined"!=typeof leadcityid?ko.observable(leadcityid<=0):ko.observable(!1),a.pincode=ko.observable(),a.dealerCityName=ko.observable(),a.dealerAreaName=ko.observable(),a.leadId=ko.observable(0),a.selectedMLADealerIds=ko.observableArray([]),a.MLADealers=ko.observableArray([]),a.isBikeSelected=ko.observable(!1),a.isUserAreaAvailable=ko.computed((function(){return a.cityId()==o.CityId&&o.AreaId>0})),a.mlaGALabel=ko.observable(""),a.leadPopupOrigin=ko.observable(LeadPopupOriginEnum.NonFinance),a.isMLAActive="undefined"!=typeof isMLAActive?ko.observable(isMLAActive):ko.observable(!1),a.showOffersOnPopup="undefined"!=typeof showOffersOnPopup?ko.observable(showOffersOnPopup):ko.observable(!1),a.showOffers=ko.computed((function(){return parseInt(a.leadPopupOrigin())!=LeadPopupOriginEnum.Finance&&a.showOffersOnPopup()})),a.showNoCampaignScreen=ko.observable(!1),a.dummyCampaignFlow=ko.observable(!1),a.isLeadPopupFlow=ko.observable(!1),a.isAreaLeadPopStateFlow=ko.observable(!1),a.isTollFreeCTAShown=ko.observable(!1),a.cityMaskingName=ko.observable(""),a.makeMaskingName=ko.observable(""),a.makeName=ko.observable(""),a.dealerShowRoomUrl=ko.observable(),a.commonBhriguLabel=ko.observable(),a.showDealerDetails=ko.observable(!1),a.recoBikes=ko.observableArray([]),a.selectedRecoModelIds=ko.observableArray([]),a.isRecoBikeAvailable=ko.observable(!1),a.isRecoApiCalled=ko.observable(!1),a.isCrossSellCampaign=ko.observable(!1),a.showDealersOnSorryScreen=ko.observable(!1),a.selectedCityName=ko.observable("undefined"!=typeof leadCity&&""!=leadCity?leadCity:GetGlobalLocationObject().CityName),a.lxmsDealers=ko.observableArray([33520,36385]),a.IsBoosterCampaign=ko.computed((function(){return void 0!==a.dealerId()&&36385==parseInt(a.dealerId())})),a.showBuyingTimeDrp=ko.observable(!1),a.buyTimeRequiredCampaigns=ko.observableArray([330]);var l=[{Id:1,Value:"0 - 3 Months"},{Id:2,Value:"4 - 6 Months"},{Id:3,Value:"7 - 12 Months"},{Id:4,Value:"Not yet decided"}];function n(e,a,i,t,o,d){this.dealerId=e,this.name=a,this.area=i,this.distance=0!=t?(t!=Math.round(t)?t.toFixed(1):t)+" Kms":"",this.areaId=o,this.campaignId=d}a.modifyRecoBikeIds=ko.computed({read:function(){},write:function(e,i){a.isAllRecoBikeSelected()?a.selectedRecoModelIds([]):(a.selectedRecoModelIds([]),ko.utils.arrayForEach(a.recoBikes(),(function(e){a.selectedRecoModelIds.push(e.modelId)}))),a.recoSelectAllBtnTracking()}}).extend({rateLimit:1}),a.isAllRecoBikeSelected=ko.computed((function(){return a.selectedRecoModelIds().length==a.recoBikes().length})).extend({rateLimit:1}),a.submitRecoBikeLeads=function(){if(isSendLeadsToLxms){var e=new Object;e.bikesLeadList=[],a.recoBikes().forEach((function(i){a.selectedRecoModelIds().indexOf(i.modelId)>-1&&e.bikesLeadList.push({ModelId:i.modelId,VersionId:i.versionId,CampaignId:i.campaign.campaignId,DealerId:i.campaign.dealerId,LeadType:i.campaign.leadType,DealerName:i.campaign.dealerName,BikeName:i.makeName.concat(" ",i.modelName)})})),e.cityId=leadcityid>0?leadcityid:a.cityId(),e.areaId=a.isUserAreaAvailable()?o.AreaId:a.areaId(),e.primaryEncryptedLeadId=a.leadId(),e.leadCategory=LeadCategoryEnum.Recommendation,a.pushLeadDetails(e)}else a.pushRecoLeads();closeLeadPopup()},a.pushRecoLeads=function(){var e={pqGuid:a.pqGUId(),customerName:a.fullName(),customerMobile:a.mobileNo(),customerEmail:a.emailId(),cityId:leadcityid>0?leadcityid:a.cityId(),cityName:a.selectedCityName(),areaId:a.isUserAreaAvailable()?o.AreaId:0,areaName:a.isUserAreaAvailable()?o.AreaName:0,leadSourceId:a.leadSourceId(),pincodeId:a.pincode()||0,deviceId:getCookie("BWC"),platformId:platformId,pageId:null!=gaObj?gaObj.id:3,bikeLeadList:[]};a.recoBikes().forEach((function(i){a.selectedRecoModelIds().indexOf(i.modelId)>-1&&e.bikeLeadList.push({dealerId:i.campaign.dealerId,versionId:i.versionId,campaignId:i.campaign.campaignId,dealerName:i.campaign.dealerId,bikeName:i.makeName.concat(" ",i.modelName),leadType:i.campaign.leadType})})),$.ajax({type:"POST",url:"/api/campaign/recolead/",data:ko.toJSON(e),beforeSend:function(e){e.setRequestHeader("utma",getCookie("__utma")),e.setRequestHeader("utmz",getCookie("_bwutmz")),e.setRequestHeader("platformId",platformId)},contentType:"application/json",dataType:"json",success:function(i){a.recoLeadSuccessTracking(e.bikeLeadList.length),platformId!=PlatformEnum.Amp&&leadVM.leadSourceId()!=bannerLeadId||("function"==typeof redirectPageUrl?redirectPageUrl():closeLeadPopup())},complete:function(e,a,i){platformId!=PlatformEnum.Desktop&&(LeadPopupState.close(),$("body").removeClass("lock-browser-scroll"),windowScreen.unlock())}})},a.getRecommendationBikes=function(){if(a.isRecoApiCalled())a.setRecoBikesState();else{var e=leadcityid>0?leadcityid:a.cityId(),i=a.mfgCampaignId()>0?LeadTypeEnum.ES:LeadTypeEnum.DS,t=a.IsBoosterCampaign()?"/api/booster-bikes/modelId/".concat(a.modelId(),"/cityId/",e,"/"):"/api/recommended-bikes/modelId/".concat(a.modelId(),"/cityId/",e,"/?isPincodeRequired=",a.pinCodeRequired(),"&isOtpRequired=",a.isOtpRequired(),"&isEmailRequired=","Required"==a.emailOption(),"&campaignId=",i==LeadTypeEnum.DS?a.campaignId():a.mfgCampaignId(),"&camapignType=",i,"&isCrossSellCampaign=",a.isCrossSellCampaign(),"&areaId=",leadVM.areaId()>0?leadVM.areaId():o.AreaId);$.ajax({url:t,async:!0,beforeSend:function(e){a.showLoader()},json:!0,contentType:"application/json",success:function(e){try{a.recoBikes(null!=e&&e.length>0?e:[]),a.isRecoApiCalled(!0),a.setRecoBikesState()}catch(e){a.hideLoader()}},error:function(e,i,t){a.hideLoader()},complete:function(e,i,t){a.selectedCityName("undefined"!=typeof leadCity&&""!=leadCity?leadCity:GetGlobalLocationObject().CityName),a.hideLoader()}})}},a.setRecoBikesState=function(){a.recoBikes().length>0&&(a.isRecoBikeAvailable(!0),$(".recobikes-screen").addClass("bikes--active"),null!=a.MLADealers()&&0!=a.MLADealers().length||LeadPopupState.setFinalScreen()),a.mfgCampaignId()>0&&leadVM.setESLeadSubmissionState()},a.recoLeadSuccessTracking=function(e){a.setCommonBhriguLabel(),cwTracking.trackCustomData("BWLeadPopUp","Reco_Lead_Success_".concat(e,"/",null!=a.recoBikes()?a.recoBikes().length:0,"_models_Lead_Submitted"),leadVM.commonBhriguLabel())},a.recoCloseBtnTracking=function(){a.setCommonBhriguLabel(),cwTracking.trackCustomData("BWLeadPopUp","Reco_Closed_Clicked",leadVM.commonBhriguLabel())},a.recoSelectAllBtnTracking=function(){a.setCommonBhriguLabel(),cwTracking.trackCustomData("BWLeadPopUp","Reco_Select_All_Clicked",leadVM.commonBhriguLabel())},a.setCommonBhriguLabel=function(){leadVM.commonBhriguLabel("cityId="+leadVM.cityId()+"|areaId="+leadVM.areaId()+"|modelId="+leadmodelid)},a.selectedBike.subscribe((function(e){null==e||gaObj.id!=gaEnum.Dealer_Locator_City_Page&&gaObj.id!=gaEnum.Dealer_Locator_Details_Page&&platformId!=PlatformEnum.Amp&&!isRequestedForApp||a.isBikeSelected()||(a.isMLAActive()&&triggerNonInteractiveGA(gaObj.name,"MLA_Eligible_Lead_Popup_Shown",a.selectedBike().bike+"_"+(void 0!==a.dealerCityName()?a.dealerCityName():o.CityName)+"_"+(a.isUserAreaAvailable()?o.AreaName:null)),a.isBikeSelected(!0),leadmodelid=a.selectedBike().model.modelId,leadBikeName=a.selectedBike().bike)})),a.setMLADealers=function(e){null!=e&&e.length>0&&(a.MLADealers.removeAll(),e.forEach((function(e){if(e.DealerId!=a.dealerId()){var i=a.isUserAreaAvailable()||a.areaId()?e.Distance:0;a.MLADealers.push(new n(e.DealerId,e.Name,e.Area,i,e.AreaId,e.CampaignId))}})),null!=a.MLADealers()&&a.MLADealers().length>0&&setMlaCssClassActive())},a.getMLADealers=function(){if(a.validateUserInfo(fullName,emailid,mobile))if(a.isMLAActive()||leadVM.leadSourceId()==bannerLeadId||gaObj.id==gaEnum.Dealer_Locator_City_Page||gaObj.id==gaEnum.Dealer_Locator_Details_Page||platformId==PlatformEnum.Amp||isRequestedForApp){var e=a.selectedBike().model.modelId||a.modelId();if(e>0){var i="/api/dealers/model/"+e+"/city/"+(leadcityid>0?leadcityid:a.cityId())+"/dealerId/"+a.dealerId()+"/?areaId="+(a.isUserAreaAvailable()?o.AreaId:a.areaId()>0?a.areaId():"0");$.ajax({url:i,async:!1,beforeSend:function(e){a.showLoader()},json:!0,contentType:"application/json",success:function(e){try{var i=JSON.parse(e);a.setMLADealers(i),triggerNonInteractiveGA(gaObj.name,"MLA_Primary_Lead_Success_"+a.MLADealers().length+"_dealers_shown",a.selectedBike().bike+"_"+(void 0!==a.dealerCityName()?a.dealerCityName():o.CityName)+"_"+(a.isUserAreaAvailable()?o.AreaName:"null"))}catch(e){a.hideLoader()}},error:function(e,i,t){a.hideLoader()},complete:function(e,i,t){a.hideLoader()}})}}else a.setMLADealers(mlaDealers),triggerNonInteractiveGA(gaObj.name,"MLA_Primary_Lead_Success_"+a.MLADealers().length+"_dealers_shown",a.selectedBike().bike+"_"+o.CityName+"_"+o.AreaName)},a.modifyMLADealerIds=ko.computed({read:function(){},write:function(e,i){a.isSelectAllChecked()?a.selectedMLADealerIds([]):(a.selectedMLADealerIds([]),ko.utils.arrayForEach(a.MLADealers(),(function(e){a.selectedMLADealerIds.push(e.dealerId)}))),gaObj.id==gaEnum.Model_Page||gaObj.id==gaEnum.DealerPriceQuote_Page?triggerGA(gaObj.name,"MLA_Select All_Clicked",leadBikeName+"_"+o.CityName+"_"+o.AreaName):triggerGA(gaObj.name,"MLA_Select All_Clicked",a.selectedBike().bike+"_"+(void 0!==a.dealerCityName()?a.dealerCityName():o.CityName)+"_"+(a.isUserAreaAvailable()?o.AreaName:"null"))}}).extend({rateLimit:1}),a.isSelectAllChecked=ko.computed((function(){return a.selectedMLADealerIds().length==a.MLADealers().length})).extend({rateLimit:1}),a.triggerMlaGAs=function(e,i){gaObj.id==gaEnum.Model_Page||gaObj.id==gaEnum.DealerPriceQuote_Page?triggerGA(gaObj.name,i.target.dataset.act,leadBikeName+"_"+o.cityName+"_"+o.AreaName):null!=a.selectedBike()&&triggerGA(gaObj.name,i.target.dataset.act,a.selectedBike().bike+"_"+(void 0!==a.dealerCityName()?a.dealerCityName():o.CityName)+"_"+(a.isUserAreaAvailable()?o.AreaName:"null"))},a.triggerCloseBtnGA=function(e){isMLAActive&&LeadPopupState.status==LeadPopupStateEnum.Final&&a.triggerMlaGAs(null,e)},a.triggerCloseBtnBhrigu=function(){leadVM.isRecoBikeAvailable()&&LeadPopupState.status==LeadPopupStateEnum.Final&&a.recoCloseBtnTracking()},a.submitLeadToMLADealers=function(){gaObj.id==gaEnum.Model_Page||gaObj.id==gaEnum.DealerPriceQuote_Page||gaObj.id==gaEnum.PriceInCity_Page?triggerGA(gaObj.name,"MLA_Lead_Success_"+a.selectedMLADealerIds().length+"/"+a.MLADealers().length+"_dealers_Lead Submitted",leadBikeName+"_"+o.CityName+"_"+o.AreaName):triggerGA(gaObj.name,"MLA_Lead_Success_"+a.selectedMLADealerIds().length+"/"+a.MLADealers().length+"_dealers_Lead Submitted",a.selectedBike().bike+"_"+(void 0!==a.dealerCityName()?a.dealerCityName():o.CityName)+"_"+(a.isUserAreaAvailable()?o.AreaName:"null"));var e=new Object;e.bikesLeadList=[],ko.utils.arrayForEach(a.MLADealers(),(function(i){a.selectedMLADealerIds().indexOf(i.dealerId)>-1&&e.bikesLeadList.push({ModelId:a.modelId(),VersionId:a.versionId(),CampaignId:i.campaignId,DealerId:i.dealerId,LeadType:LeadTypeEnum.DS})})),e.cityId=a.cityId(),e.areaId=a.isUserAreaAvailable()?o.AreaId:a.areaId(),e.primaryEncryptedLeadId=a.leadId(),e.leadCategory=LeadCategoryEnum.MLA,a.pushLeadDetails(e)},a.FilterData=function(e,a){if(filterObj=e,a&&a.length>1){var i=new RegExp(a,"i");filterObj=e.filter((function(e){if(i.test(e.cityName))return e}))}return filterObj},a.visibleCities=ko.computed((function(){return a.FilterData(a.cities(),a.cityFilter())})),a.openCityList=function(){var e=$("#pqcity-slideIn-drawer");if(e.show("slide",{direction:"right"},500,(function(){e.addClass("fix-header-input")})),$(document).height()>$(window).height()){var a=windowScreen.htmlElement.scrollTop()?windowScreen.htmlElement.scrollTop():windowScreen.bodyElement.scrollTop();a<0&&(a=0),windowScreen.htmlElement.addClass("lock-browser-scroll").css("top",-a)}},a.closeCityList=function(){var e=$("#pqcity-slideIn-drawer");e.hide("slide",{direction:"right"},500,(function(){})),e.removeClass("fix-header-input"),windowScreen.unlock()},a.getModelCities=function(e,i){if(a.modelId()>0&&a.cityRequired()&&!a.selectedCity()&&!a.isLeadPopupFlow()){var t=$("#getLeadCity");$.ajax({type:"GET",url:"/api/PQCityList/?modelId="+a.modelId(),dataType:"json",success:function(e){var i=e.cities;i&&i.length>0?(platformId==PlatformEnum.Desktop&&i.splice(0,0,d),a.cities(i)):a.cities([]),t.trigger("chosen:updated"),$(this).parent().removeClass("done")}})}},a.selectCity=function(e,i){if(platformId==PlatformEnum.Desktop){var t=$("#getLeadCity");a.selectedCity()&&a.selectedCity().cityId>0&&(hideError(t),t.parent().addClass("done"),a.cityId(a.selectedCity().cityId),a.isRegisterPQ(!0),a.dealersRequired()&&a.getDealersList(a.dealerId()))}else a.selectedCity(e),a.selectedCity()&&a.selectedCity().cityId>0&&(a.cityId(a.selectedCity().cityId),a.dealersRequired()&&a.getDealersList(a.dealerId()),a.isRegisterPQ(!0)),a.closeCityList(),a.validateCity()},a.setOptions=function(e){null!=e&&(null!=e.eventcategory&&a.eventCategory(e.eventcategory),null!=e.dealercityname&&a.dealerCityName(e.dealercityname),null!=e.dealerareaname&&a.dealerAreaName(e.dealerareaname),null!=e.dealerid&&a.dealerId(e.dealerid),null!=e.dealername&&a.dealerName(e.dealername),null!=e.dealerarea&&a.dealerArea(e.dealerarea),null!=e.versionid&&a.versionId(e.versionid),null!=e.modelid&&a.modelId(e.modelid),null!=e.leadsourceid&&a.leadSourceId(e.leadsourceid),null!=e.pqsourceid&&a.pqSourceId(e.pqsourceid),null!=e.isregisterpq&&a.isRegisterPQ(e.isregisterpq),null!=e.campaignId&&a.campaignId(e.campaignId),null!=e.mfgCampid&&a.mfgCampaignId(e.mfgCampid),null!=e.dealerMessage&&""!=e.dealerMessage&&a.dealerMessage(e.dealerMessage),null!=e.pinCodeRequired&&a.pinCodeRequired("boolean"==typeof e.pinCodeRequired&&e.pinCodeRequired||"True"===e.pinCodeRequired||"true"===e.pinCodeRequired),null!=e.isOtpRequired&&a.isOtpRequired("boolean"==typeof e.isOtpRequired&&e.isOtpRequired||"True"===e.isOtpRequired||"true"===e.isOtpRequired),null!=e.emailRequired&&(a.emailRequired("Not_Required"!=e.emailRequired),a.emailOption(e.emailRequired)),null!=e.dealersRequired&&(a.dealersRequired("boolean"==typeof e.dealersRequired&&e.dealersRequired||"True"===e.dealersRequired||"true"===e.dealersRequired),a.cityId()&&a.dealersRequired()&&a.getDealersList(a.dealerId())),null!=e.isdealerbikes&&e.isdealerbikes&&(a.isDealerBikes(e.isdealerbikes),a.getDealerBikes()),a.cityRequired()&&a.getModelCities(),null!=e.isleadpopup?a.IsLeadPopup("false"!=e.isleadpopup):a.IsLeadPopup(!0),null!=e.pqguid&&e.pqguid&&a.pqGUId(e.pqguid),null!=e.pqid&&e.pqid&&a.pqId(e.pqid),null!=e.gaobject&&a.GAObject(e.gaobject),null!=e.pageurl&&(a.pageUrl=e.pageurl),null!=e.clientip&&(a.clientIP=e.clientip),null!=e.sendLeadSMSCustomer&&a.sendLeadSMSCustomer(e.sendLeadSMSCustomer),null!=e.organizationName&&a.organizationName(e.organizationName),null!=e.isTollFreeCTAShown&&a.isTollFreeCTAShown(e.isTollFreeCTAShown),null!=e.showNoCampaignScreen&&a.showNoCampaignScreen("True"==e.showNoCampaignScreen),null!=e.dummyCampaignFlow&&a.dummyCampaignFlow("True"==e.dummyCampaignFlow),null!=e.iscrosssellcampaign&&a.isCrossSellCampaign(e.iscrosssellcampaign),a.leadPopupOrigin(null!=e.leadPopupOrigin?e.leadPopupOrigin:LeadPopupOriginEnum.NonFinance),a.isBikeSelected(!1),a.showNoCampaignScreen()&&LeadPopupState.setSorryScreen(!0),null!=e.showDealerDetails&&a.showDealerDetails(e.showDealerDetails),a.mfgCampaignId()>0?(e.dealerHeading&&!e.dealerHeading.startsWith("Provide")?a.dealerHeading(e.dealerHeading):a.dealerHeading(a.organizationName()?a.organizationName():a.dealerName()),e.dealerDescription&&!e.dealerDescription.startsWith("Dealership")?a.dealerDescription(e.dealerDescription):a.dealerDescription("Authorised Dealership will get back to you with offers, EMI quotes, exchange benefits and much more!")):(a.dealerHeading(a.dealerName()),a.dealerDescription("Dealership will get back to you with offers, EMI quotes, exchange benefits and much more!")),null!=e.mfgCampid&&a.buyTimeRequiredCampaigns().indexOf(parseInt(e.mfgCampid))>-1&&(a.showBuyingTimeDrp(!0),a.setBuyingTimesHtml()))},a.destroyOptions=function(){a.dealerId(0),a.dealerName(""),a.dealerArea(""),a.versionId(0),a.modelId(0),a.leadSourceId(0),a.pqSourceId(0),a.mfgCampaignId(0),a.dealerHeading(""),a.dealerMessage(""),a.dealerDescription(""),a.pinCodeRequired(!1),a.isOtpRequired(!1),a.emailRequired("Not_Required"),a.dealersRequired(!1),a.organizationName(""),a.sendLeadSMSCustomer(!1),a.showBuyingTimeDrp(!1)},a.getDealerBikes=function(e,i){if(!isNaN(a.dealerId())&&a.dealerId()>0&&a.campaignId()>0){var t="dealerDetails_"+a.dealerId()+"_camp_"+a.campaignId(),o=lscache.get(t);if(o)obj=ko.toJS(o),a.dealerBikes([]),a.dealerBikes(obj.dealerBikes),platformId==PlatformEnum.Desktop&&$("#getLeadBike").trigger("chosen:updated");else{startLoading(leadBike.parent()),platformId==PlatformEnum.Desktop?leadBike.prev().show():leadBike.find(".btnSpinner").show();var d="/api/DealerBikes/?dealerId="+a.dealerId()+"&campaignId="+a.campaignId();makeId>0&&(d+="&makeId="+makeId),$.ajax({type:"GET",url:d,contentType:"application/json",dataType:"json",beforeSend:function(e){a.showLoader(),e.setRequestHeader("utma",getCookie("__utma")),e.setRequestHeader("utmz",getCookie("_bwutmz"))},success:function(e){lscache.set(t,e,30),obj=ko.toJS(e),a.dealerBikes([]),a.dealerBikes(obj.dealerBikes),platformId==PlatformEnum.Desktop&&$("#getLeadBike").trigger("chosen:updated")},complete:function(e){a.hideLoader(),204!=e.status&&404!=e.status||lscache.set(t,null,30),stopLoading(leadBike.parent()),platformId==PlatformEnum.Desktop?leadBike.prev().hide():leadBike.find(".btnSpinner").hide()}})}}},a.getDealersList=function(){a.lxmsDealers().indexOf(parseInt(a.dealerId()))>-1?$.ajax({type:"GET",url:"/api/ManufacturerCampaign/lxmsclient/campaignId/".concat(a.mfgCampaignId(),"/?cityid=",a.cityId(),"&modelId=",a.modelId()),contentType:"application/json",dataType:"json",success:function(e){if(null!=e&&e.ClientId>0){var i=cwapiHostUrl.concat("/api/dealers/?modelId=",a.modelId(),"&application=2&isEsMappingPresent=true&clientId=",e.ClientId,"&makeId=",e.MakeId,"&cityIds=",a.cityId());null!=e.PrimaryCityIds&&e.PrimaryCityIds.length>0&&e.PrimaryCityIds.forEach(e=>i=e!=a.cityId()?i.concat("&cityIds=",e):i)}i&&""!=i?a.getLxmsOutletDealers(i):a.setNoOutletDealer()},complete:function(e){200!=e.status&&a.setNoOutletDealer()}}):a.getManufacturerOutlets()},a.setNoOutletDealer=function(){$("#ddlMfgDealers").html(""),$("#ddlMfgDealers").append("<option value selected>No dealer present</option>"),$("#getDealer-select-box").find(".dropdown-menu").remove(),platformId!=PlatformEnum.Desktop&&void 0!==dropdown&&dropdown.setMenu($("#ddlMfgDealers")),$("#ddlMfgDealers").trigger("chosen:updated")},a.getLxmsOutletDealers=function(e){$.ajax({type:"GET",url:e,contentType:"application/json",dataType:"json",success:function(e){var i=ko.toJS(e);a.setOutletDealersHtml(i)},complete:function(e){200!=e.status&&a.setNoOutletDealer()}})},a.setOutletDealersHtml=function(e){var t=e.length,o=$("#ddlMfgDealers");if(platformId!=PlatformEnum.Desktop&&$("#dealerDropdownLabel").hide(),t>=1){for(o.html(""),t>1&&o.append("<option value selected>Select dealer</option>"),i=0;i<t;i++){var d=e[i],l="";null!=d.area&&(l=", "+d.area),o.append("<option value="+(i+1)+" data-id='"+d.id+"' >"+(d.name&&""!=d.name?d.name:d.dealerName)+l+"</option>")}1==t&&(o.val("0"),o.closest(".select-box").addClass("done"))}else a.setNoOutletDealer();platformId==PlatformEnum.Desktop?o.trigger("chosen:updated"):($("#getDealer-select-box").find(".dropdown-menu").remove(),void 0!==dropdown&&dropdown.setMenu(o))},a.setBuyingTimesHtml=function(){var e=l.length,a=$("#ddlBuyingTime");for(platformId!=PlatformEnum.Desktop&&$("#buyingTimeDropdownLabel").hide(),a.html(""),e>1&&a.append("<option value selected>Select a buying span</option>"),i=0;i<e;i++){var t=l[i];a.append("<option value="+t.Id+" data-id='"+t.Id+"' data-text='"+t.Value+"' >"+t.Value+"</option>")}platformId==PlatformEnum.Desktop?a.trigger("chosen:updated"):($("#buyingTime-select-box").find(".dropdown-menu").remove(),void 0!==dropdown&&dropdown.setMenu(a))},a.getManufacturerOutlets=function(){$.ajax({type:"GET",url:"/api/ManufacturerCampaign/city/"+a.cityId()+"/dealer/"+a.dealerId()+"/",contentType:"application/json",dataType:"json",success:function(e){var i=ko.toJS(e);a.setOutletDealersHtml(i)},complete:function(e){200!=e.status&&a.setNoOutletDealer()}})},a.generatePQ=function(e,i){if(isSuccess=!1,isValidDetails=!1,isValidDetails=a.validateUserInfo(fullName,emailid,mobile),a.isDealerBikes()){var t=a.selectedBike();t&&t.version&&t.model?(a.versionId(t.version.versionId),a.modelId(t.model.modelId)):(a.versionId(0),a.modelId(0))}if(isValidDetails&&a.modelId()&&a.versionId()){var o={dealerId:a.dealerId(),modelId:a.modelId(),versionId:a.versionId(),cityId:a.cityId(),areaId:a.areaId(),clientIP:a.clientIP,pageUrl:a.pageUrl,sourceType:null!=platformId?platformId:1,pQLeadId:a.pqSourceId(),deviceId:getCookie("BWC")};return a.registerPQ(o)}return isSuccess},a.registerPQ=function(e){var i=!1;if(e){$.ajax({type:"POST",url:"/api/v1/registerpq/",async:!1,data:ko.toJSON(e),contentType:"application/json",dataType:"json",beforeSend:function(e){a.showLoader()},success:function(e){a.pqGUId(e.quoteId),i=!0},complete:function(e){a.hideLoader(),200!=e.status&&(a.IsVerified(!1),i=!1,stopLoading($("#user-details-submit-btn").parent()))}})}return i},a.pushToGA=function(e,i){null!=e&&null!=e.act&&("lead_label"==e.lab&&(e.lab=a.selectedBike().make.makeName+"_"+a.selectedBike().model.modelName+"_"+CityArea),triggerGA(e.cat,e.act,e.lab))},a.submitDSLead=function(e,i){if((a.isRegisterPQ()||a.isLeadPopupFlow()&&!a.showDealersOnSorryScreen())&&a.generatePQ(e,i),(a.pqGUId()||a.pqId())&&a.dealerId()){var t=new Object;t.bikesLeadList=[{ModelId:a.modelId(),VersionId:a.versionId(),CampaignId:a.campaignId(),LeadType:LeadTypeEnum.DS,DealerName:a.organizationName()?a.organizationName():a.dealerName(),BikeName:leadBikeName,DealerId:a.dealerId()}],t.cityId=a.cityId(),t.areaId=a.isUserAreaAvailable()?o.AreaId:a.areaId(),t.leadCategory=LeadCategoryEnum.DS,a.pushLeadDetails(t),a.getRecommendationBikes()}},a.submitESLead=function(e,i){a.validateUserInfo(fullName,emailid,mobile)&&a.mfgCampaignId()>0&&(a.pqGUId()&&""!=a.pqGUId()&&"0"!=a.pqGUId()||a.generatePQ(e,i),a.ko_DealerName($("#ddlMfgDealers option:selected").text()),$("#processing").show(),a.isOtpRequired()?(input={mobile:document.querySelector(".js-mobile-number").value,sourceModule:SourceModule.newBikeLeads,applicationId:Application.Bikewale,platformId:platformId,deviceId:getCookie("BWC"),otpLength:"5"},a.beginOtpValidation(input)):a.pushESLeadCommon())},a.beginOtpValidation=function(e){otpVerificationClass=new UserVerification(e),OtpVerification.setDefaultParameter(otpVerificationClass),otpVerificationClass.checkIfUserVerified().then(e=>{if(e.isMobileVerified)a.pushESLeadCommon();else{otpVerificationClass.initiateOtpVerification(),otpVerificationClass.initiateMissedCallVerification().then(e=>{OtpVerification.bindTollFreeNumber(e.tollFreeNumber)}),$("#personalInfo").hide();var i=document.getElementById("contactDetailsPopup"),t=document.getElementById("contactDetaileValidatorPopUp");i.classList.remove("contact-detail--active"),t.classList.add("otp-verification--active")}})},a.pushESLeadCommon=function(){if(a.lxmsDealers().indexOf(parseInt(a.dealerId()))>-1){var e=new Object;e.bikesLeadList=[{ModelId:a.modelId(),VersionId:a.versionId(),DealerId:a.dealerId(),CampaignId:a.mfgCampaignId(),LeadType:LeadTypeEnum.ES,DealerName:a.organizationName()?a.organizationName():a.dealerName(),BikeName:leadBikeName,AssignedDealerId:$("#ddlMfgDealers :selected").length>0?$("#ddlMfgDealers :selected").data("id"):0}],e.cityId=a.cityId(),e.pincode=a.pincode()||0,e.leadCategory=LeadCategoryEnum.ES,a.pushLeadDetails(e)}else a.pushESLead();setPQUserCookie(),a.getRecommendationBikes()},a.pushESLead=function(){var e={dealerId:a.dealerId(),pqId:0,pqguid:a.pqGUId(),name:a.fullName(),mobile:a.mobileNo(),email:a.emailId(),versionId:a.versionId(),cityId:a.cityId(),leadSourceId:a.leadSourceId(),pinCode:a.pincode()||0,campaignId:a.mfgCampaignId(),deviceId:getCookie("BWC"),manufacturerDealerId:$("#ddlMfgDealers :selected").data("id"),manufacturerDealer:a.ko_DealerName(),bikeName:leadBikeName,dealerName:a.organizationName()?a.organizationName():a.dealerName(),sendLeadSMSCustomer:a.sendLeadSMSCustomer(),leadId:a.leadId(),platformId:platformId,pageId:pageId,emailOption:a.emailOption(),leadCityId:leadcityid,ipToLocationCityId:"undefined"==typeof ipToLocationCityId||null==ipToLocationCityId?"0":ipToLocationCityId,buyingTime:$("#ddlBuyingTime :selected").data("text")};$.ajax({type:"POST",url:"/api/ManufacturerLead/",data:ko.toJSON(e),beforeSend:function(e){a.showLoader(),e.setRequestHeader("utma",getCookie("__utma")),e.setRequestHeader("utmz",getCookie("_bwutmz"))},async:!0,contentType:"application/json",dataType:"json",success:function(e){a.leadId(e)},error:function(e,a,i){$("#leadCapturePopup").show(),popup.lock(),$("#processing").hide(),$("#otpPopup").hide(),$("#contactDetailsPopup").removeClass("contact-detail--active")},complete:function(e,a,i){}})},a.pushLeadDetails=function(e){if(null==e||null==e)e=new Object;e.name=a.fullName(),e.email=a.emailId(),e.mobile=a.mobileNo(),e.ipToLocationCityId="undefined"==typeof ipToLocationCityId||null==ipToLocationCityId?"0":ipToLocationCityId,e.pqGuid=a.pqGUId(),e.leadSourceId=a.leadSourceId(),e.inquirySourceId=inquirySource,e.platformId=platformId,e.pageId="undefined"!=typeof gaObj?gaObj.id:0,e.deviceId=getCookie("BWC"),e.appVersionId=isRequestedForApp?appVersionId:0,$.ajax({type:"POST",url:"/api/lead/",data:ko.toJSON(e),beforeSend:function(i){e.leadCategory==LeadCategoryEnum.ES&&a.showLoader(),i.setRequestHeader("utma",getCookie("__utma")),i.setRequestHeader("utmz",getCookie("_bwutmz"))},async:!0,contentType:"application/json",dataType:"json",success:function(i){a.leadId(i),a.IsVerified(!0),e.leadCategory==LeadCategoryEnum.Recommendation?a.recoLeadSucceed(e):e.leadCategory==LeadCategoryEnum.MLA?a.mlaLeadSucceed():e.leadCategory==LeadCategoryEnum.DS&&a.dsLeadSucceed()},error:function(a,i,t){console.log(t),e.leadCategory==LeadCategoryEnum.ES&&($("#leadCapturePopup").show(),popup.lock(),$("#processing").hide(),$("#otpPopup").hide(),$("#contactDetailsPopup").removeClass("contact-detail--active"))},complete:function(i){200!=i.status&&a.IsVerified(!1),e.leadCategory==LeadCategoryEnum.Recommendation?a.recoLeadCompleted():e.leadCategory==LeadCategoryEnum.MLA&&a.mlaLeadCompleted()}})},a.dsLeadSucceed=function(){"undefined"!=typeof isReactNativeApp&&isReactNativeApp&&window.ReactNativeWebView.postMessage(leadSubmitObject)},a.recoLeadSucceed=function(e){a.recoLeadSuccessTracking(e.bikesLeadList.length),platformId!=PlatformEnum.Amp&&leadVM.leadSourceId()!=bannerLeadId||("function"==typeof redirectPageUrl?redirectPageUrl():closeLeadPopup())},a.recoLeadCompleted=function(){platformId!=PlatformEnum.Desktop&&(LeadPopupState.close(),$("body").removeClass("lock-browser-scroll"),windowScreen.unlock())},a.mlaLeadSucceed=function(){a.isRecoBikeAvailable()?(leadVM.dealerMessage("A consultant would get in touch with you shortly with assistance on your purchase."),LeadPopupState.setFinalScreen(),"undefined"!=typeof isReactNativeApp&&isReactNativeApp&&(mlaleadSubmitObject.selectedDealerCount=a.selectedMLADealerIds().length,window.ReactNativeWebView.postMessage(JSON.stringify(mlaleadSubmitObject)))):platformId==PlatformEnum.Amp||leadVM.leadSourceId()==bannerLeadId?"function"==typeof redirectPageUrl?redirectPageUrl():closeLeadPopup():"undefined"!=typeof isReactNativeApp&&isReactNativeApp?(mlaleadSubmitObject.selectedDealerCount=a.selectedMLADealerIds().length,window.ReactNativeWebView.postMessage(JSON.stringify(mlaleadSubmitObject))):"undefined"!=typeof isApp&&isApp&&Android.closeForm()},a.mlaLeadCompleted=function(){a.isRecoBikeAvailable()?LeadPopupState.setFinalScreen():"undefined"!=typeof isReactNativeApp&&isReactNativeApp?closeLeadPopup():"undefined"!=typeof isApp&&isApp?Android.closeForm():platformId!=PlatformEnum.Desktop?(LeadPopupState.close(),$("body").removeClass("lock-browser-scroll"),windowScreen.unlock()):closeLeadPopup()},a.setESLeadSubmissionState=function(){a.hideLoader(),$("#contactDetailsPopup").removeClass("contact-detail--active"),$("#personalInfo").hide(),$("#otpPopup").hide(),$("#processing").hide(),$("#notify-response .notify-leadUser").text(a.fullName()),$("#notify-response").addClass("notify-response--active"),LeadPopupState.setFinalScreen(),a.cityRequired()&&a.selectedCity()&&!a.isLeadPopupFlow()&&SetCookieInDays("location",a.selectedCity().cityId+"_"+a.selectedCity().cityName,365),fbPixelLeadEvent&&fbq("track",fbPixelLeadEvent),"undefined"!=typeof isReactNativeApp&&isReactNativeApp&&window.ReactNativeWebView.postMessage(leadSubmitObject)},a.submitLead=function(e,i){if($("#personalInfo").hide(),null!=a.selectedBike()&&(gaLabel=a.selectedBike().bike+"_"+(void 0!==a.dealerCityName()?a.dealerCityName():o.CityName)+(null!=a.dealerAreaName()?"_"+a.dealerAreaName():"")),a.mfgCampaignId()>0)a.submitESLead(e,i),isHiddenLeadSubmission||trackLeadPopupEvent(LeadPopupTrackingEvent.Success);else{switch(a.IsVerified(!1),$(i.currentTarget).attr("id")){case"user-details-submit-btn":isValidDetails=a.validateUserInfo("#getFullName","#getEmailID","#getMobile");break;case"dealer-assist-btn":case"assistFormSubmit":isValidDetails=a.validateUserInfo("#assistGetName","#assistGetEmail","#assistGetMobile")}a.dealerId()&&isValidDetails&&(LeadPopupState.setMLAScreen(),setPQUserCookie(),a.submitDSLead(),isHiddenLeadSubmission||trackLeadPopupEvent(LeadPopupTrackingEvent.Success),a.IsLeadPopup()?$("#personalInfo").hide():($("#buyingAssistance").hide(),$("#dealer-assist-msg").fadeIn()),a.IsVerified()&&triggerGA(a.eventCategory(),eventAction,gaLabel),fbPixelLeadEvent&&fbq("track",fbPixelLeadEvent))}window.google_trackConversion({google_conversion_id:998187973,google_conversion_language:"en",google_conversion_format:"3",google_conversion_color:"ffffff",google_conversion_label:"vUR5CPXFq3EQxcf82wM",google_remarketing_only:!1})},a.HiddenSubmitLead=function(e,i){ele=$(i.target);var t={dealerid:ele.attr("data-item-id"),dealername:ele.attr("data-item-name"),dealerarea:ele.attr("data-item-area"),versionid:ele.attr("data-versionid"),leadsourceid:ele.attr("data-leadsourceid"),pqsourceid:ele.attr("data-pqsourceid"),isleadpopup:ele.attr("data-isleadpopup"),mfgCampid:ele.attr("data-mfgcampid"),pqguid:pqId,isregisterpq:ele.attr("data-isregisterpq"),pageurl:pageUrl,clientip:clientIP,eventcategory:ele.attr("data-cat"),dealercityname:ele.attr("data-cityname"),campaignId:ele.attr("data-campaignid")};isNaN(t.versionid)||"0"==t.versionid||(!a.modelId()&&ele.attr("data-modelId")&&a.modelId(ele.attr("data-modelId")),a.setOptions(t),isHiddenLeadSubmission=!0,a.submitLead(e,i))},a.setPinCodeSuggestion=function(){$.fn.hint=bwHint,$.fn.bw_autocomplete=bwAutoComplete,$("#getPinCode").bw_autocomplete({source:4,recordCount:3,minLength:2,onClear:function(){objPinCodes=new Object},click:function(e,i,t){if(a.selectedBike()&&a.selectedBike().make&&a.selectedBike().model){var o=a.selectedBike().make.makeName+"_"+a.selectedBike().model.modelName+"_pinCode_"+$("#getPinCode").val();dataLayer.push({event:"Bikewale_all",cat:"LeadCapture_Popup",act:"PinCode_Selected",lab:o})}i&&i.item?a.pincode(i.item.payload.pinCode):a.pincode(0)},open:function(e){objPinCodes.result=e},focusout:function(){""!=$("#getPinCode").find("li.ui-state-focus a:visible").text()?($("#errPinCodeSearch").hide(),focusedMakeModel=new Object,focusedMakeModel=objPinCodes.result?objPinCodes.result[$("li.ui-state-focus").index()]:null):$("#errPinCodeSearch").hide()},afterfetch:function(e,i){null!=e&&e.length>0&&""!=i.trim()?$("#errPinCodeSearch").hide():(focusedMakeModel=null,""!=i.trim()&&($("#errPinCodeSearch").show(),a.pincode(0)))},keyup:function(){""!=$("#getPinCode").val().trim()&&""!=$("li.ui-state-focus a:visible").text()?(focusedMakeModel=new Object,focusedMakeModel=objPinCodes.result?objPinCodes.result[$("li.ui-state-focus").index()]:null,$("#errPinCodeSearch").hide()):""==$("#getPinCode").val().trim()&&$("#errPinCodeSearch").hide(),""!=$("#getPinCode").val().trim()&&27!=e.keyCode&&13!=e.keyCode||(null==focusedMakeModel||null==focusedMakeModel?""!=$("#getPinCode").val().trim()&&($("#errPinCodeSearch").show(),a.pincode(0)):$("#errPinCodeSearch").hide())}}).autocomplete({appendTo:autocompletePincodeElement}).autocomplete("widget").addClass(autocompletePincodeClass)},a.checkPinCode=function(e){return isValid=!1,$.ajax({async:!1,type:"GET",url:"/api/autosuggest/?source=4&inputText="+e+"&noofrecords=5",contentType:"application/json",dataType:"json",success:function(e){e&&e.suggestionList.length>0?($("#getPinCode").val(e.suggestionList[0].text),a.lxmsDealers().indexOf(parseInt(a.dealerId())),a.pincode(e.suggestionList[0].payload.pinCodeId),isValid=!0):(validate.setError($("#getPinCode"),"Invalid pincode"),a.pincode(0),isValid=!1)}}),isValid},a.validateUserInfo=function(e,i,t){var o=!0;return o=a.validateUserName(e),o&=a.validateEmailId(i),o&=a.validateMobileNo(t),o&=a.validateCity(),a.dealersRequired()&&(o&=a.validateDealer()),a.pinCodeRequired()&&(o&=a.validatePinCode()),a.isDealerBikes()&&(o&=a.validateBike()),a.showBuyingTimeDrp()&&(o&=a.validateBuyingTime()),o},a.validateDealer=function(e){var a=!1;return""==$("#ddlMfgDealers :selected").text()||""==$("#ddlMfgDealers :selected").val()?validate.setError($("#ddlMfgDealers"),"Please select dealer"):a=!0,a},a.validateBuyingTime=function(){var e=!1;return""==$("#ddlBuyingTime :selected").text()||""==$("#ddlBuyingTime :selected").val()?validate.setError($("#ddlBuyingTime"),"Please select a buying span"):e=!0,e},a.validateUserName=function(e){var i=!1;return null!=a.fullName()&&""!=a.fullName().trim()?(nameLength=a.fullName().length,-1!=a.fullName().indexOf("&")?(validate.setError($(e),"Invalid name"),i=!1):0==nameLength?(validate.setError($(e),"Please enter your name"),i=!1):/^[a-zA-Z ]{1,50}$/.test(a.fullName())?nameLength>=1&&(validate.hideError($(e)),i=!0):(validate.setError($(e),"Name cannot be more than 50 characters"),i=!1)):(validate.setError($(e),"Please enter your name"),i=!1),i},a.validateEmailId=function(e){var i=!0,t=$(e).val();return"Required"==a.emailOption()&&""==t?(validate.setError($(e),"Please enter email id"),i=!1):""==t||null==t?i=!0:/^[A-z0-9._+-]+@[A-z0-9.-]+\.[A-z]{2,6}$/.test(t)||(validate.setError($(e),"Invalid Email"),i=!1),i},a.validatePinCode=function(){var e=$("#getPinCode"),i=!0,t=e.val().trim();return t.indexOf(",")>0&&(t=t.substring(0,6)),""==t?(validate.setError(e,"Please enter pincode"),i=!1):/^[1-9][0-9]{5}$/.test(t)||(validate.setError(e,"Invalid pincode"),i=!1),i&&(i&=a.checkPinCode(t)),i},a.validateMobileNo=function(e){return mobileVal=$(e).val(),validateMobileNo(mobileVal,a)?(validate.hideError($(e)),!0):(validate.setError($(e),a.msg),!1)},a.validateBike=function(){var e=!0;return eleBike=$("#getLeadBike"),null!=eleBike&&null!=a.selectedBike()&&a.selectedBike().model&&a.selectedBike().model.modelId>0?(hideError(eleBike),e=!0):(setError(eleBike,"Select a bike"),e=!1),e},a.validateCity=function(){var e=!0;return eleCity=platformId==PlatformEnum.Desktop?$("#getLeadCity"):$("#city-select-element").find(".city-box-default"),null!=eleCity&&null!=a.cityId()&&a.cityId()>0?(hideError(eleCity),e=!0):(setError(eleCity,"Please Select a city"),e=!1),e},a.setInputValues=function(){for(var e=$(".personal-info-form-container .input-box, #buyingAssistance .input-box, .personal-info-form-container .js-input-box, #buyingAssistance .js-input-box"),a=0;a<e.length;a++){var i=$(e[a]);i.find("input").val().length>0&&i.addClass("not-empty")}},a.showLoader=function(){$("#leadCapturePopup").addClass("lead-popup--loader"),$("#ub-ajax-loader").show()},a.hideLoader=function(){$("#leadCapturePopup").removeClass("lead-popup--loader"),$("#ub-ajax-loader").hide()},a.formatPrice=function(e){if(null!=e)if(0==e)e="N/A";else{var a=(e=e.toString()).substring(e.length-3),i=e.substring(0,e.length-3);""!=i&&(a=","+a);e=i.replace(/\B(?=(\d{2})+(?!\d))/g,",")+a;e="₹ ".concat(e)}return e},a.setLxmsDealers=function(){$.ajax({type:"GET",url:"/api/lead/lxmsmigrateddealers/",contentType:"application/json",async:!1,dataType:"json",success:function(e){a.lxmsDealers(null!=e&&e.length>0?e:[])},error:function(e,i,t){console.log(t),a.lxmsDealers([])}})}}function setuserDetails(){var e=document.cookie.match("(^|;) ?_PQUser=([^;]*)(;|$)");return e?e[2].split("&"):null}function setPQUserCookie(){var e=leadVM.fullName()+"&"+leadVM.emailId()+"&"+leadVM.mobileNo();SetCookie("_PQUser",e)}function startLoading(e){$(e).find(".progress-bar").css({width:"0"}).show().animate({width:"100%"},500)}function stopLoading(e){$(e).find(".progress-bar").stop(!0,!0).css({width:"100%"}).fadeOut(1e3)}function setSelectedElement(e,a){e.parent().prev("input[type='text']").val(a),$("#brandSearchBar").addClass("open").animate({left:"100%"},500)}Object.freeze(LeadPopupTrackingEvent),leadVM=new leadModel,null!=document.querySelector("#leadCapturePopup")&&ko.applyBindings(leadVM,document.getElementById("leadCapturePopup")),docReady((function(){windowScreen={htmlElement:$("html"),bodyElement:$("body"),lock:function(){if($(document).height()>$(window).height()){var e=windowScreen.htmlElement.scrollTop()?windowScreen.htmlElement.scrollTop():windowScreen.bodyElement.scrollTop();e<0&&(e=0),windowScreen.htmlElement.addClass("lock-browser-scroll").css("top",-e)}},unlock:function(){var e=parseInt(windowScreen.htmlElement.css("top"));windowScreen.htmlElement.removeClass("lock-browser-scroll"),$("html, body").scrollTop(-e)}},$("#contactDetailsPopup .dropdown-select-wrapper").on("click",".dropdown-label",(function(){leadCapturePopup.animate({scrollTop:leadCapturePopup[0].scrollHeight})})),leadCapturePopup=$("#leadCapturePopup"),leadBike=$("#getLeadBike"),fullName=$("#getFullName"),emailid=$("#getEmailID"),mobile=$("#getMobile"),assistanceGetName=$("#assistanceGetName"),assistanceGetEmail=$("#assistanceGetEmail"),assistanceGetMobile=$("#assistanceGetMobile"),detailsSubmitBtn=$("#user-details-submit-btn"),FbPixelEvent&&(fbPixelLeadEvent=FbPixelEvent.lead),offerExpandedCss(),$(document).on("click",".leadcapturebtn",openLeadPopup),$(document).on("click",".sorryscreenleadbutton",(function(e){$(".response-popup-wrapper").addClass("hide"),$(".response-popup-wrapper").removeClass("response-popup--active"),platformId==PlatformEnum.Desktop?(document.getElementById("leadCapturePopup").classList.remove("sorryscreenwidth"),LeadPopupState.close(),popup.unlock()):(LeadPopupState.close(),$("body").removeClass("lock-browser-scroll"),windowScreen.unlock());var a=$(this);try{var i={dealerid:a.attr("data-item-id"),dealername:a.attr("data-item-name"),dealerarea:a.attr("data-item-area"),versionid:null!=a.attr("data-versionid")?a.attr("data-versionid"):versionId,leadsourceid:a.attr("data-leadsourceid"),pqsourceid:a.attr("data-pqsourceid"),isleadpopup:a.attr("data-isleadpopup"),pageurl:window.location.href,clientip:a.attr("data-clientip"),campaignId:a.attr("data-campaignid"),pqguid:a.attr("data-pqid")};leadVM.setOptions(i)}catch(e){console.warn("Unable to get submit details : "+e.message)}openLeadPopup()})),$(".leadCapture-close-btn").on("click",(function(e){leadVM.triggerCloseBtnGA(e),leadVM.triggerCloseBtnBhrigu(),closeLeadPopup()})),$(".blackOut-window, .js-sorry__screen__okay-btn").on("click",(function(){closeLeadPopup()})),$(".dealers__skip-btn").on("click",(function(){leadVM.isRecoBikeAvailable()?LeadPopupState.setFinalScreen():closeLeadPopup()})),$(document).on("click","#notifyOkayBtn",(function(){"undefined"!=typeof isApp&&isApp?"undefined"!=typeof isReactNativeApp&&isReactNativeApp?window.ReactNativeWebView.postMessage(closeFormObject):$(".inapp-leadCapture-close-btn").trigger("click"):closeLeadPopup()})),$(document).on("keydown",(function(e){27===e.keyCode&&("undefined"!=typeof isApp&&isApp?leadCapturePopup.find(".inapp-leadCapture-close-btn").trigger("click"):closeLeadPopup())})),$("#dealer-assist-msg .assistance-response-close").on("click",(function(){$("#dealer-assist-msg").parent().slideUp()})),$("#getFullName, #assistGetName").on("focus",(function(){validate.onFocus($(this),leadCapturePopup)})),$("#getEmailID, #assistGetEmail").on("focus",(function(){validate.onFocus($(this),leadCapturePopup),prevEmail=$(this).val().trim()})),$("#getMobile, #assistGetMobile").on("focus",(function(){validate.onFocus($(this),leadCapturePopup),prevMobile=$(this).val().trim()})),$(document).on("focus","#getPinCode",(function(){validate.onFocus($(this),leadCapturePopup),prevPinCode=$(this).val().trim().substring(0,6)})),$("#getFullName, #assistGetName").on("blur",(function(){validate.onBlur($(this))})),$("#getMobile, #assistGetMobile").on("blur",(function(){validate.onBlur($(this)),prevMobile!=$(this).val().trim()&&leadVM.validateMobileNo($(this))&&leadVM.IsVerified(!1)})),$(document).on("blur","#getPinCode",(function(){validate.onBlur($(this));var e=$(this).val().trim();e.indexOf(",")>0&&(e=e.substring(0,6)),e.length>0&&!/^[1-9][0-9]{5}$/.test(e)&&validate.setError($("#getPinCode"),"Invalid pincode")})),$(document).on("click","#templist li",(function(){validate.setError($("#ddlMfgDealers"),"")})),$(document).on("change","#getLeadBike",(function(){null!=$(this).val()&&"0"!=$(this).val()?hideError($(this)):setError($(this))})),$("#getEmailID, #assistGetEmail").on("blur",(function(){validate.onBlur($(this)),prevEmail!=$(this).val().trim()&&leadVM.validateEmailId($(this))&&leadVM.IsVerified(!1)})),$("#dealerAssistance")&&$("#dealerAssistance").length>0&&ko.applyBindings(leadVM,document.getElementById("dealerAssistance")),$("#getPinCode")&&$("#getPinCode").length>0&&leadVM.setPinCodeSuggestion(),leadVM.setInputValues(),leadCapturePopup.on("click",".dealer-search-brand",(function(){$(".dealer-brand-wrapper").show(),$("#brandSearchBar").addClass("open").animate({left:"0px"},500),$("#brandSearchBar").find(".user-input-box").animate({left:"0px"},500),$("#assistanceBrandInput").focus()})),leadCapturePopup.on("click","#sliderBrandList li",(function(){var e=$(this),a=e.text();setSelectedElement(e,a),e.addClass("activeBrand").siblings().removeClass("activeBrand"),$(".dealer-search-brand-form").addClass("selection-done").find("span").text(a),$("#brandSearchBar").find(".user-input-box").animate({left:"100%"},500),validateInputSelection.hideError($(".dealer-search-brand-form"))})),leadCapturePopup.on("click",".dealer-brand-wrapper .back-arrow-box",(function(){$("#brandSearchBar").removeClass("open").animate({left:"100%"},500),$("#brandSearchBar").find(".user-input-box").animate({left:"100%"},500)})),agreementPolicyPopup.registerEvents()}));var agreementPolicyPopup=function(){var e,a;function i(){e.fadeOut(200),popup.unlock()}return{registerEvents:function(){e=$("#policyPopup"),$(".policy-close-btn"),$("#leadCapturePopup"),a=$(".policy-container"),$("#visitor-agreement-link, #privacy-policy-link").on("click",(function(e){e.preventDefault();var a=$("#policyPopupContainer");1===$(this).data("link")?$.ajax({type:"GET",url:"/Privacy/PrivacyPolicy/",contentType:"application/json",dataType:"html",success:function(e){a.html(e)},error:function(){a.html("Page Not Found")}}):2===$(this).data("link")&&$.ajax({type:"GET",url:"/Privacy/VisitorAgreement/",contentType:"application/json",dataType:"html",success:function(e){a.html(e)},error:function(){a.html("Page Not Found")}}),agreementPolicyPopup.open()})),$(".policy-close-btn").on("click",(function(){e.is(":visible")&&window.history.back()})),a.on("scroll",(function(){0==a.scrollTop()?$(".policy-container").removeClass("box-shadow-top"):$(".policy-container").addClass("box-shadow-top")})),$(window).on("popstate",(function(){e.is(":visible")&&i()}))},open:function(){popup.lock(),e.fadeIn(200),$("#policyPopupContainer").scrollTop(0),history.pushState("agreementpopup","","")},close:i}}();function closeLeadPopup(){"undefined"==typeof isApp||isApp?"undefined"!=typeof isApp&&("undefined"!=typeof isReactNativeApp&&isReactNativeApp?window.ReactNativeWebView.postMessage(closeFormObject):Android.closeForm()):($(".blackOut-window").hide(),leadVM.dealerMessage(""),platformId==PlatformEnum.Desktop?(LeadPopupState.close(),popup.unlock()):(LeadPopupState.close(),$("body").removeClass("lock-browser-scroll"),windowScreen.unlock()),leadVM.isLeadPopupFlow()&&("undefined"!=typeof redirectUrl&&""!=redirectUrl?window.location=redirectUrl:null!=vmquotation&&null!=vmquotation.PQSourceId&&vmquotation.PQSourceId.length>0?setTimeout((function(){window.location.href=window.location.origin+window.location.pathname+"?pqsourceid="+vmquotation.PQSourceId}),200):setTimeout((function(){window.location.reload(!0)}),200)));var e=document.getElementById("contactDetaileValidatorPopUp");e&&e.classList.remove("otp-verification--active");var a=document.querySelector(".js-verification-wrapper");if(a){var i=a.querySelector(".js-tick-icon"),t=a.querySelector(".js-otp-error-text"),o=a.querySelector(".otp-update-msg");i.classList.remove("tick-container--active"),document.getElementById("getOtp").value="",t.classList.add("error-text--hide"),t.parentElement.classList.remove("invalid"),a.classList.remove("input-field-wrapper--active"),o.classList.remove("otp-update-msg--active")}}function openLeadPopup(){var e=GetGlobalLocationObject();null!==leadVM.selectedBike()&&void 0!==leadVM.selectedBike()||leadVM.selectedBike({bike:leadBikeName,model:{modelId:leadmodelid}}),platformId==PlatformEnum.Desktop?(LeadPopupState.open(),!isMLAActive||gaObj.id!=gaEnum.Model_Page&&gaObj.id!=gaEnum.DealerPriceQuote_Page||triggerNonInteractiveGA(gaObj.name,"MLA_Eligible_Lead_Popup_Shown",leadBikeName+"_"+e.CityName+"_"+e.AreaName),popup.lock()):($("#selectedbike").html("Select a bike<sup>*</sup>"),LeadPopupState.open(),(isMLAActive&&gaObj.id==gaEnum.Model_Page||gaObj.id==gaEnum.DealerPriceQuote_Page)&&triggerNonInteractiveGA(gaObj.name,"MLA_Eligible_Lead_Popup_Shown",leadBikeName+"_"+e.CityName+"_"+e.AreaName),$("#otherDealer").show(),"fetchCampaign"==window.history.state?window.history.replaceState("leadCapture","",""):appendState("leadCapture"),windowScreen.lock())}function getDealersWithCampaigns(e,a,i){leadVM.showLoader(),$.ajax({async:!1,type:"GET",url:"/api/dealerswithcampaigns/modelid/"+e+"/cityid/"+a+"/areaid/"+i+"/?platform="+platformId,contentType:"application/json",dataType:"json",success:function(e){null!==e&&(leadVM.showDealersOnSorryScreen(!0),renderSorryScreen(e)),leadVM.hideLoader()},error:function(e){leadVM.hideLoader()}})}function renderSorryScreen(e){var a=document.getElementById("sorryScreenDealers"),i=document.createElement("p");if(i.className="sorryscreenDealers-message font14 margin-bottom20",platformId==PlatformEnum.Desktop){document.getElementById("leadCapturePopup").classList.add("sorryscreenwidth");var t="However, here is a list of some of the nearby dealerships"}else{document.getElementsByClassName("response-popup__content")[0].classList.add("sorryscreenshown");t="Sorry, we couldn’t find any partner dealerships in your area. However, here is a list of some of the nearby dealerships"}var o=document.createTextNode(t);i.appendChild(o);var d=document.createElement("div");e.forEach((function(e){var a=document.createElement("span");a.className="top4 vertical-top margin-right5 tel-sm-blue-icon";var i=GetDealerContactTag(e.MaskingNumber),t=document.createElement("span");t.className="bwsprite bwmsprite margin-right5 dealership-loc-icon vertical-top";var o=document.createElement("div"),l=document.createElement("div");o.classList="sorryscreen-dealerdetails inline-block";var n=document.createElement("p"),r=document.createTextNode(e.Name+", "+e.ObjArea.AreaName);n.className="sorryscreen-dealername font14",n.appendChild(r),l.appendChild(n);var s=document.createElement("div");(n=document.createElement("p")).appendChild(t),r=document.createTextNode(e.Address),n.className="sorryscreen-dealeraddress font14",s.className="inline-block",n.appendChild(r),s.appendChild(n),l.appendChild(s);var c=document.createElement("div");c.appendChild(a),c.appendChild(i),l.appendChild(c),l.classList="width70 margin-bottom15",o.appendChild(l),d.appendChild(o)}));var l=document.createElement("a");l.innerHTML="View More Dealers",l.className="btn btn-orange btn-full-width font18 sorry-screen__viewmoredealers js-sorry__screen__okay-btn margin-top10";var n="/dealer-showrooms/"+leadVM.makeMaskingName()+"/"+leadVM.cityMaskingName()+"/";if(n=platformId!==PlatformEnum.Desktop?"/m"+n:n,l.setAttribute("href",n),platformId==PlatformEnum.Desktop){var r=document.createElement("span");r.className="bwsprite teal-right",l.appendChild(r)}a.appendChild(i),a.appendChild(d),a.appendChild(l)}function GetDealerContactTag(e){for(DealerMaskingNumbers=e.split(","),mainPTag=document.createElement("p"),mainPTag.className="sorryscreen-dealerphone font14 inline-block",i=0;i<DealerMaskingNumbers.length;i++)anchorTag=document.createElement("a"),anchorTag.setAttribute("href","tel:"+DealerMaskingNumbers[i]),i<DealerMaskingNumbers.length-1&&(DealerMaskingNumbers[i]=DealerMaskingNumbers[i].concat(", ")),aText=document.createTextNode(DealerMaskingNumbers[i]),anchorTag.appendChild(aText),mainPTag.appendChild(anchorTag);return mainPTag}function isFinancePatner(e){return-1!==[28454,24434,25698].indexOf(e)}function getCampaignDetails(e,a,i){leadVM.showLoader(),$.ajax({async:!1,type:"GET",url:"/api/campaign/modelId/"+e+"/cityId/"+a+"/?areaId="+i,contentType:"application/json",dataType:"json",success:function(e){if(leadVM.commonBhriguLabel("cityId="+leadVM.cityId()+"|areaId="+leadVM.areaId()+"|modelId="+leadmodelid),!e||null==e.dealerCampaign&&null==e.manufacturerCampaign)leadVM.isAreaLeadPopStateFlow()&&(url="/dealer-showrooms/"+leadVM.makeMaskingName()+"/"+leadVM.cityMaskingName()+"/",url=platformId!==PlatformEnum.Desktop?"/m"+url:url,leadVM.dealerShowRoomUrl(url)),LeadPopupState.setSorryScreen(!0);else if(e.dealerCampaign&&e.dealerCampaign.dealerId>0&&e.dealerCampaign.campaignId>0)e.dealerCampaign=setCampaignTrackingSources(e.dealerCampaign),showDealerCampaign(e.dealerCampaign),LeadPopupState.open(),leadVM.isMLAActive(!0);else if(e.manufacturerCampaign&&(e.manufacturerCampaign.emiCampaign||e.manufacturerCampaign.leadCampaign)){var a;(a=parseInt(leadVM.leadPopupOrigin())==LeadPopupOriginEnum.Finance?setCampaignTrackingSources(e.manufacturerCampaign.emiCampaign):setCampaignTrackingSources(e.manufacturerCampaign.leadCampaign))&&a.dealerId>0&&!isFinancePatner(a.dealerId)&&a.campaignId>0&&(showManufacturerCampaign(a),LeadPopupState.open())}else LeadPopupState.setSorryScreen(!0);leadVM.hideLoader()},error:function(e){leadVM.hideLoader()}})}function setCampaignTrackingSources(e){return null!=e&&(e.leadsourceId=leadVM.leadSourceId(),e.pqsourceId=22),e}function showDealerCampaign(e){setLeadPopup({dealerid:e.dealerId,dealername:e.organization,dealerarea:e.area,versionid:"undefined"!=typeof versionId?versionId:leadVM.versionId(),leadsourceid:e.leadsourceId,pqsourceid:e.pqsourceId,pqguid:"undefined"!=typeof pqId?pqId:"",pageurl:"undefined"!=typeof pageUrl?pageUrl:"",clientip:"undefined"!=typeof clientIP?clientIP:"",eventcategory:"Model_Page",gaobject:{cat:"Model_Page",act:"Request_Callback_Details_Clicked",lab:"bikeVersionLocation"},campaignId:e.campaignId,isTollFreeCTAShown:!1})}function showManufacturerCampaign(e){setLeadPopup({dealerid:e.dealerId,dealername:e.organization,dealerarea:"",versionid:"undefined"!=typeof versionId?versionId:leadVM.versionId(),leadsourceid:e.leadsourceId,pqsourceid:e.pqsourceId,mfgCampid:e.campaignId,pqId:0,pqguid:"undefined"!=typeof pqId?pqId:"",pageurl:"undefined"!=typeof pageUrl?pageUrl:"",clientip:"undefined"!=typeof clientIP?clientIP:"",dealerHeading:e.popupHeading,dealerMessage:e.popupSuccessMessage,dealerDescription:e.popupDescription,pinCodeRequired:e.pincodeRequired,isOtpRequired:e.isOtpRequired,emailRequired:e.emailRequired,dealersRequired:e.dealerRequired,eventcategory:"Model_Page",gaobject:{cat:"Model_Page",act:"Request_Callback_Details_Clicked",lab:"bikeVersionLocation"},sendLeadSMSCustomer:e.sendLeadSMSCustomer,organizationName:e.Organization,campaignId:e.campaignId,isTollFreeCTAShown:leadVM.isTollFreeCTAShown()})}function setLeadPopup(e){leadVM.setOptions(e)}function trackLeadPopupEvent(e){var a="",i="",t="",o="",d=!1;switch(e){case LeadPopupTrackingEvent.ESLeadPopUpShown:a=t="ESLeadPopUpShown",i=setGALabel(),o=setBhriguLabel(leadVM.modelId(),leadVM.leadSourceId(),platformId,leadVM.cityId(),leadVM.areaId(),leadVM.showOffers());break;case LeadPopupTrackingEvent.DSLeadPopUpShown:a=t="DSLeadPopUpShown",i=setGALabel(),o=setBhriguLabel(leadVM.modelId(),leadVM.leadSourceId(),platformId,leadVM.cityId(),leadVM.areaId(),leadVM.showOffers());break;case LeadPopupTrackingEvent.Close:a=t="LeadPopupClose",d=!0,i=setGALabel(),o=setBhriguLabel(leadVM.modelId(),leadVM.leadSourceId(),platformId,leadVM.cityId(),leadVM.areaId(),leadVM.showOffers());break;case LeadPopupTrackingEvent.Success:a=t="Lead_Success",d=!0,i=setGALabel(),o=setBhriguLabel(leadVM.modelId(),leadVM.leadSourceId(),platformId,leadVM.cityId(),leadVM.areaId(),leadVM.showOffers())}d?triggerGA("Lead_Popup",a,i):triggerNonInteractiveGA("Lead_Popup",a,i),t.length>0&&(o=o+"|action="+t),cwTracking.trackCustomData("BWLeadPopUp",t,o)}function setBhriguLabel(e,a,i,t=0,o=0,d=!1){return"modelId="+e+"|cityId="+t+"|areaId="+o+"|leadSourceId="+a+"|platformId="+i+"|hasOffers="+d}function setGALabel(){var e="";return"undefined"!=typeof leadBikeName&&leadBikeName.length>0?e+=leadBikeName+"_":void 0!==leadVM.selectedBike()&&void 0!==leadVM.selectedBike().bike&&""!=leadVM.selectedBike().bike&&(e+=leadVM.selectedBike().bike+"_"),"undefined"!=typeof leadcityname&&leadcityname.length>0?(e+=leadcityname+"_","undefined"!=typeof leadareaname&&leadareaname.length>0&&(e+=leadareaname)):"undefined"!=typeof leadcityname&&0!=leadcityname.length||void 0===leadVM||void 0===leadVM.selectedCity()||(e+=leadVM.selectedCity().cityName),"_"==e[e.length-1]&&(e=e.slice(0,-1)),e}